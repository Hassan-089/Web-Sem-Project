<div class="container" style="padding: 2rem; max-width: 800px; margin: 0 auto;">
    <h2 style="text-align: center; margin-bottom: 2rem;">Order Preview</h2>

    <% if (products.length> 0) { %>
        <table
            style="width: 100%; border-collapse: collapse; margin-bottom: 2rem; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <thead>
                <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                    <th style="padding: 1rem; text-align: left;">Product</th>
                    <th style="padding: 1rem; text-align: center;">Price</th>
                    <th style="padding: 1rem; text-align: center;">Quantity</th>
                    <th style="padding: 1rem; text-align: right;">Total</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(p=> { %>
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 1rem;">
                            <strong>
                                <%= p.item.name %>
                            </strong>
                        </td>
                        <td style="padding: 1rem; text-align: center;">$<%= p.price %>
                        </td>
                        <td style="padding: 1rem; text-align: center;">
                            <%= p.qty %>
                        </td>
                        <td style="padding: 1rem; text-align: right;">$<%= p.price * p.qty %>
                        </td>
                    </tr>
                    <% }) %>
                        <tr style="font-weight: bold; background-color: #f8f9fa;">
                            <td colspan="3" style="padding: 1rem; text-align: right;">Subtotal:</td>
                            <td style="padding: 1rem; text-align: right;">$<%= totalPrice.toFixed(2) %>
                            </td>
                        </tr>
                        <% if (discount> 0) { %>
                            <tr style="font-weight: bold; color: #28a745; background-color: #f8f9fa;">
                                <td colspan="3" style="padding: 1rem; text-align: right;">Discount (10%):</td>
                                <td style="padding: 1rem; text-align: right;">-$<%= discount.toFixed(2) %>
                                </td>
                            </tr>
                            <% } %>
                                <tr style="font-weight: bold; font-size: 1.2rem; background-color: #e9ecef;">
                                    <td colspan="3" style="padding: 1rem; text-align: right;">Grand Total:</td>
                                    <td style="padding: 1rem; text-align: right;">$<%= finalTotal ?
                                            finalTotal.toFixed(2) : totalPrice.toFixed(2) %>
                                    </td>
                                </tr>
            </tbody>
        </table>

        <!-- Coupon Section -->
        <div
            style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem; text-align: right;">
            <form action="/order/preview" method="GET" style="display: inline-block;">
                <label style="margin-right: 10px; font-weight: bold;">Have a Coupon?</label>
                <input type="text" name="coupon" placeholder="Enter code"
                    value="<%= locals.couponApplied ? 'SAVE10' : '' %>"
                    style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button type="submit"
                    style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
            </form>
            <% if (locals.couponApplied) { %>
                <p style="color: green; margin-top: 5px;">Coupon SAVE10 applied!</p>
                <% } %>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center;">
            <a href="/"
                style="text-decoration: none; padding: 10px 20px; border: 1px solid #333; color: #333; border-radius: 4px;">&larr;
                Go Back to Shopping</a>

            <form action="/order/confirm" method="POST">
                <button type="submit"
                    style="background-color: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 4px; font-size: 1.1rem; cursor: pointer;">
                    Confirm Order
                </button>
            </form>
        </div>
        <% } else { %>
            <div style="text-align: center; padding: 3rem;">
                <h3>Your cart is empty!</h3>
                <a href="/"
                    style="display: inline-block; margin-top: 1rem; text-decoration: none; background-color: #007bff; color: white; padding: 10px 20px; border-radius: 4px;">Start
                    Shopping</a>
            </div>
            <% } %>
</div>